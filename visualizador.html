<html><head><base href="https://opensource.code"><title>Visão Geral da Obra - Reforma RED</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script><script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script><script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/MTLLoader.js"></script><script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script><script src="https://cdn.jsdelivr.net/npm/chart.js"></script></head><body><div class="columns is-gapless is-multiline"><div class="column is-full"><div id="house-3d" class="is-relative" style="height: 50vh;"><div class="box m-2 is-absolute" style="top: 10px; left: 10px; z-index: 100; background-color: rgba(255, 255, 255, 0.8); width: 225px;"><div class="buttons are-fullwidth"><button id="moveUpBtn" class="button is-primary"><span class="icon"><i class="fas fa-arrow-up"></i></span></button><button id="moveDownBtn" class="button is-primary"><span class="icon"><i class="fas fa-arrow-down"></i></span></button><button id="frameObjectBtn" class="button is-primary"><span class="icon"><i class="fas fa-expand"></i></span></button><button id="settingsBtn" class="button is-primary"><span class="icon"><i class="fas fa-cog"></i></span></button></div></div><div id="viewCubeContainer" class="is-absolute" style="top: 10px; right: 10px; width: 100px; height: 100px; z-index: 100;"></div></div></div><div class="column is-full"><div id="cost-overview" class="section"><div class="container"><h1 class="title is-4">VISÃO GERAL DA OBRA - REFORMA RED - 190m²</h1><div class="columns"><div class="column is-4"><div class="box"><canvas id="costByPhaseChart"></canvas></div></div><div class="column is-4"><div class="box has-text-centered"><p class="heading">Custo Planejado Total</p><p class="title">R$133.858,24</p></div></div><div class="column is-4"><div class="box"><canvas id="costByStageChart"></canvas></div></div></div><div class="box" style="max-height: 300px; overflow-y: auto;"><table id="costTable" class="table is-fullwidth"><thead><tr><th>Descrição</th><th>Und</th><th>QTD</th><th>Valor Unit</th></tr></thead><tbody></tbody></table></div></div></div></div></div><div id="settingsPanel" class="modal"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button id="closeSettingsBtn" class="delete" aria-label="close"></button></header><section class="modal-card-body"><div class="columns"><div class="column is-3"><aside class="menu"><p class="menu-label">Appearance</p><ul class="menu-list"><li><a href="#" data-section="appearance">Appearance Settings</a></li></ul><p class="menu-label">General</p><ul class="menu-list"><li><a href="#" data-section="model-files">Model Files</a></li></ul></aside></div><div class="column"><div id="appearance" class="settings-section"><h3>Appearance Settings</h3><label for="bgColor">Background Color:</label><input type="color" id="bgColor" value="#ffffff"><label for="objectColor">Object Color:</label><input type="color" id="objectColor" value="#cccccc"><label for="lightIntensity">Brightness:</label><input type="range" id="lightIntensity" min="0" max="2" step="0.1" value="0.5"></div><div id="model-files" class="settings-section" style="display: none;"><h3>Model Files</h3><label for="objFile">OBJ File URL:</label><input type="text" id="objFile" value="https://faganelo.me/Bambo_House.obj"><label for="mtlFile">MTL File URL:</label><input type="text" id="mtlFile" value="https://faganelo.me/Bambo_House.mtl"><button id="saveModelFiles" class="button is-success">Save and Update Object</button></div></div></div></section></div></div><script>const scene = new THREE.Scene();scene.background = new THREE.Color(0xffffff);const camera = new THREE.PerspectiveCamera(75, window.innerWidth / (window.innerHeight/2), 0.1, 1000);const renderer = new THREE.WebGLRenderer();renderer.setSize(window.innerWidth, window.innerHeight/2);document.getElementById('house-3d').appendChild(renderer.domElement);const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);scene.add(ambientLight);const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);directionalLight.position.set(1, 1, 1);scene.add(directionalLight);const controls = new THREE.OrbitControls(camera, renderer.domElement);controls.enableDamping = true;controls.dampingFactor = 0.25;controls.screenSpacePanning = false;controls.maxPolarAngle = Math.PI / 2;const mtlLoader = new THREE.MTLLoader();const objLoader = new THREE.OBJLoader();let houseObject;mtlLoader.load('https://faganelo.me/Bambo_House.mtl', (materials) => {materials.preload();objLoader.setMaterials(materials);objLoader.load('https://faganelo.me/Bambo_House.obj', (object) => {houseObject = object;const box = new THREE.Box3().setFromObject(object);const center = box.getCenter(new THREE.Vector3());object.position.sub(center);const scaleJudgin = Math.max(box.max.x - box.min.x, box.max.y - box.min.y, box.max.z - box.min.z);const scale = 5 / scaleJudgin;object.scale.set(scale, scale, scale);scene.add(object);frameObject();addViewCube();},(xhr) => {console.log((xhr.loaded / xhr.total * 100) + '% loaded');},(error) => {console.log('An error happened', error);});});function frameObject() {if (houseObject) {const box = new THREE.Box3().setFromObject(houseObject);const center = box.getCenter(new THREE.Vector3());const size = box.getSize(new THREE.Vector3());const maxDim = Math.max(size.x, size.y, size.z);const fov = camera.fov * (Math.PI / 180);let cameraZ = Math.abs(maxDim / 2 / Math.tan(fov / 2));cameraZ *= 1.5;camera.position.set(center.x, center.y, center.z + cameraZ);camera.lookAt(center);controls.target.copy(center);camera.updateProjectionMatrix();controls.update();}}function addViewCube() {const viewCubeScene = new THREE.Scene();const viewCubeCamera = new THREE.PerspectiveCamera(75, 1, 0.1, 10);const viewCubeRenderer = new THREE.WebGLRenderer({ alpha: true });viewCubeRenderer.setSize(100, 100);document.getElementById('viewCubeContainer').appendChild(viewCubeRenderer.domElement);const geometry = new THREE.BoxGeometry(1, 1, 1);const materials = [new THREE.MeshBasicMaterial({ color: 0xff0000 }),new THREE.MeshBasicMaterial({ color: 0x00ff00 }),new THREE.MeshBasicMaterial({ color: 0x0000ff }),new THREE.MeshBasicMaterial({ color: 0xffff00 }),new THREE.MeshBasicMaterial({ color: 0xff00ff }),new THREE.MeshBasicMaterial({ color: 0x00ffff })];const cube = new THREE.Mesh(geometry, materials);viewCubeScene.add(cube);viewCubeCamera.position.set(2, 2, 2);viewCubeCamera.lookAt(viewCubeScene.position);const viewCubeControls = new THREE.OrbitControls(viewCubeCamera, viewCubeRenderer.domElement);viewCubeControls.enableDamping = true;viewCubeControls.dampingFactor = 0.25;viewCubeControls.screenSpacePanning = false;viewCubeRenderer.domElement.addEventListener('click', onViewCubeClick);function onViewCubeClick(event) {const rect = viewCubeRenderer.domElement.getBoundingClientRect();const mouse = new THREE.Vector2();mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;const raycaster = new THREE.Raycaster();raycaster.setFromCamera(mouse, viewCubeCamera);const intersects = raycaster.intersectObject(cube);if (intersects.length > 0) {const face = intersects[0].face;const normal = face.normal.clone();normal.transformDirection(cube.matrixWorld);const distance = camera.position.length();camera.position.copy(normal).multiplyScalar(distance);camera.lookAt(scene.position);controls.update();}}function animateViewCube() {requestAnimationFrame(animateViewCube);viewCubeControls.update();viewCubeRenderer.render(viewCubeScene, viewCubeCamera);}animateViewCube();}function animate() {requestAnimationFrame(animate);controls.update();renderer.render(scene, camera);}animate();const moveUpBtn = document.getElementById('moveUpBtn');const moveDownBtn = document.getElementById('moveDownBtn');const moveStep = 0.1;moveUpBtn.addEventListener('click', () => {if (houseObject) {houseObject.position.y += moveStep;}});moveDownBtn.addEventListener('click', () => {if (houseObject) {houseObject.position.y -= moveStep;}});const frameObjectBtn = document.getElementById('frameObjectBtn');frameObjectBtn.addEventListener('click', frameObject);const settingsBtn = document.getElementById('settingsBtn');const settingsPanel = document.getElementById('settingsPanel');const bgColorInput = document.getElementById('bgColor');const objectColorInput = document.getElementById('objectColor');const lightIntensityInput = document.getElementById('lightIntensity');const objFileInput = document.getElementById('objFile');const mtlFileInput = document.getElementById('mtlFile');settingsBtn.addEventListener('click', () => {settingsPanel.classList.add('is-active');});const closeSettingsBtn = document.getElementById('closeSettingsBtn');closeSettingsBtn.addEventListener('click', () => {settingsPanel.classList.remove('is-active');});document.querySelectorAll('.menu-list a').forEach(link => {link.addEventListener('click', (e) => {e.preventDefault();const sectionId = e.target.getAttribute('data-section');showSettingsSection(sectionId);});});function showSettingsSection(sectionId) {document.querySelectorAll('.settings-section').forEach(section => {section.style.display = 'none';});const selectedSection = document.getElementById(sectionId);if (selectedSection) {selectedSection.style.display = 'block';}}bgColorInput.addEventListener('input', (e) => {scene.background = new THREE.Color(e.target.value);});objectColorInput.addEventListener('input', (e) => {if (houseObject) {houseObject.traverse((child) => {if (child instanceof THREE.Mesh) {child.material.color.setHex(parseInt(e.target.value.substr(1), 16));}});}});lightIntensityInput.addEventListener('input', (e) => {ambientLight.intensity = parseFloat(e.target.value);directionalLight.intensity = parseFloat(e.target.value);});const saveModelFilesBtn = document.getElementById('saveModelFiles');saveModelFilesBtn.addEventListener('click', updateModelFiles);objFileInput.addEventListener('change', updateModelFiles);mtlFileInput.addEventListener('change', updateModelFiles);function updateModelFiles() {const objUrl = objFileInput.value;const mtlUrl = mtlFileInput.value;if (houseObject) {scene.remove(houseObject);}mtlLoader.load(mtlUrl, (materials) => {materials.preload();objLoader.setMaterials(materials);objLoader.load(objUrl, (object) => {houseObject = object;const box = new THREE.Box3().setFromObject(object);const center = box.getCenter(new THREE.Vector3());object.position.sub(center);const scaleJudgin = Math.max(box.max.x - box.min.x, box.max.y - box.min.y, box.max.z - box.min.z);const scale = 5 / scaleJudgin;object.scale.set(scale, scale, scale);scene.add(object);frameObject();});});}showSettingsSection('appearance');document.addEventListener('DOMContentLoaded', function() {const ctxPhase = document.getElementById('costByPhaseChart').getContext('2d');new Chart(ctxPhase, {type: 'bar',data: {labels: ['FASE 03', 'FASE 02', 'FASE 01', 'FASE 06', 'FASE 05', 'FASE 04'],datasets: [{label: 'Custo por Fase',data: [133858.24, 99157.97, 96417.65, 78473.57, 70138.31, 61612.82],backgroundColor: 'rgba(54, 162, 235, 0.6)',borderColor: 'rgba(54, 162, 235, 1)',borderWidth: 1}]} ,options: {indexAxis: 'y',responsive: true,maintainAspectRatio: false,plugins: {title: {display: true,text: 'Custo por Fase'},legend: {display: false}},scales: {x: {beginAtZero: true,title: {display: true,text: 'Custo (R$)'}}}}});const ctxStage = document.getElementById('costByStageChart').getContext('2d');new Chart(ctxStage, {type: 'bar',data: {labels: ['Substratos', 'Alvenaria', 'Serv. Preliminares', 'Instalações', 'Outros'],datasets: [{label: 'Custo por Etapa',data: [82317.29, 25000, 15000, 8000, 3540.95],backgroundColor: 'rgba(75, 192, 192, 0.6)',borderColor: 'rgba(75, 192, 192, 1)',borderWidth: 1}]} ,options: {indexAxis: 'y',responsive: true,maintainAspectRatio: false,plugins: {title: {display: true,text: 'Custo por Etapa'},legend: {display: false}},scales: {x: {beginAtZero: true,title: {display: true,text: 'Custo (R$)'}}}}});const tableData = [{ description: "Conduto, cabo, canal, quebra e embutimento (exceto para chuveiros)", unit: "m", quantity: 100, unitPrice: 15.50 },{ description: "Composição paramétrica de ponto de iluminação com interruptor simples...", unit: "un", quantity: 20, unitPrice: 120.75 },{ description: "Instalação de pontos de tomada", unit: "un", quantity: 30, unitPrice: 85.20 }];const tableBody = document.querySelector('#costTable tbody');tableData.forEach(item => {const row = tableBody.insertRow();row.insertCell(0).textContent = item.description;row.insertCell(1).textContent = item.unit;row.insertCell(2).textContent = item.quantity;row.insertCell(3).textContent = `R$ ${item.unitPrice.toFixed(2)}`;});});</script></body></html>
